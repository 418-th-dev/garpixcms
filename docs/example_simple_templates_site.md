# Корпорат на шаблонах

Пример простого корпоративного сайта на шаблонах.

Сайт должен включать в себя следующее:

* Главная страница
* Новости список
* Новость детальная
* О нас
* Контакты

#### Шаг 1. Создание нового проекта

Для начала, создайте новый проект по [документации](install_new_project.md).

Если после входа увидите ошибку "No template names provided" - это значит, что можно переходить к следующему шагу.

#### Шаг 2. Создаем структуру в админ-панели

Заходим в админ-панель по адресу [http://localhost:8000/admin/](http://localhost:8000/admin/).

2.1. Заходим в "Сайты". Можно отредактировать адрес сайта на тот, который вам необходим. На компьютере разработчика можно использовать и тот, что по умолчанию - `example.com`.

2.2. Заходим в "Структура страниц". Нажимаем "Добавить", заполняем поля:

* Название: "Главная"
* ЧПУ: стираем, должно быть пустым
* Сайты для отображения: Выбираем единственное значение
* Тип страницы: "Главная страница"
* Содержимое: "Главная страница моего сайта"
* Можно также заполнить SEO-теги (далее вы сможете их увидеть, если откроете код страницы [http://localhost:8000/](http://localhost:8000/))

и сохраняйте.
  
2.3. После этого, вы можете зайти на главную страницу сайта [http://localhost:8000/](http://localhost:8000/) и увидеть стандартный бутстрап-шаблон, в который вывелись значения.

2.4. Возвращаемся в административную панель и создаем еще несколько страниц через "Структуру страниц":

Страница "Контакты":

* Название: "Контакты"
* ЧПУ: автоматически
* Сайты для отображения: Выбираем единственное значение
* Тип страницы: "Обычная страница"
* Содержимое: "Мои контакты"

Страница "О нас":

* Название: "О нас"
* ЧПУ: автоматически
* Сайты для отображения: Выбираем единственное значение
* Тип страницы: "Обычная страница"
* Содержимое: "Здесь текст о нас"

2.5. Далее создаем меню. Переходим в "Пункты меню".

Добавляем три пункта меню.

Меню "Главная":

* Название для админа: Главная
* Название: Главная
* Тип меню: Header menu
* Страница, на которую ведет пункт меню: Главная страница
* Сортировка: 50

Меню "Доставка":

* Название для админа: О нас
* Название: О нас
* Тип меню: Header menu
* Страница, на которую ведет пункт меню: О нас
* Сортировка: 80

Меню "Контакты":

* Название для админа: Контакты
* Название: Контакты
* Тип меню: Header menu
* Страница, на которую ведет пункт меню: Контакты
* Сортировка: 100

2.6. После этого, вы можете зайти на главную страницу сайта [http://localhost:8000/](http://localhost:8000/) и увидеть меню, при переходе по которым можно увидеть содержимое страниц.

#### Шаг 3. Использование страниц

3.1. Пояснения

В зависимости от функциональных возможностей сайта, могут потребоваться страницы
с различным контекстом. В GarpixCMS есть возможность создавать из административной панели
страницы с различным наполнением и поддержкой ЧПУ с сохранением возможности
разработчиком использовать различные представления и контексты для страниц.

Для создания страниц используется модуль [garpix_page](https://github.com/garpixcms/garpix_page) с предустановленными параметрами
(вы можете их расширять).

Для начала надо понять терминологию:

* Страница (Page, Model Page) - это модель, дочерний класс от `BasePage`. Вы можете создавать их сами.
* Тип страницы (Page Type) - захардкоженный в `settings.py` тип страницы. Необходим для возможности создания разного поведения и представления страниц (именно поэтому он не объединен со Страницей в одну сущность).
* Контекст (Context) - функция, которая возвращает словарь. Значения можно применять в шаблонах. Всегда включает в себя `object` (объект класса страницы) и `request`.
* Шаблон (Template) - стандартный Django шаблон.

Рассмотрим то, что есть в типах страниц по умолчанию (файл `app/settings.py` импортирует все из внутреннего `garpixcms/settings.py`):

```python
PAGE_TYPE_HOME = 'HOME'  # Тип страницы
PAGE_TYPE_DEFAULT = 'DEFAULT'  # Тип страницы

PAGE_TYPES = {
    PAGE_TYPE_HOME: {
            'title': 'Главная страница',  # Название для типа страницы
            'template': 'garpixcms/pages/home.html',  # Шаблон для типа страницы
            'context': 'garpix_page.contexts.default.context'  # Контекст для типа страницы
    },
    PAGE_TYPE_DEFAULT: {
            'title': 'Обычная страница',  # Название для типа страницы
            'template': 'garpixcms/pages/default.html',  # Шаблон для типа страницы
            'context': 'garpix_page.contexts.default.context'  # Контекст для типа страницы
    },
}

CHOICES_PAGE_TYPES = [(k, v['title']) for k, v in PAGE_TYPES.items()]  # Получение choices из словаря
```

Обратите внимание, что тип страниц связывается с самой страницей (моделью) через админ-панель.

Вы можете посмотреть на страницу по умолчанию в `garpixcms/models/page`.

3.2. Добавляем новые типы страниц

Давайте добавим недостающие для нас типы страниц. Для этого разберем то, что есть сейчас и что необходимо добавить/изменить.

3.2.1. Страница "Контакты"

Эта страница должна включать в себя карту, поэтому у нее должен быть другой шаблон.
Также, координаты точки на карте и другие контакты (номер телефона, емейл, адрес) необходимо
задавать из административной панели. Соответственно, потребуется еще одна модель.

Давайте создадим новое приложение для нашего контента.

```bash
cd backend
python3 manage.py startapp content
```

Удаляем файл `models.py`, создаем директорию `models`.

В директории `models` создаем файл `contact_page.py` и создаем модель страницы (обратите внимание, на то, что это наследник `BasePage`):

```python
from garpix_page.models import BasePage
from django.db import models


class ContactPage(BasePage):
    address = models.CharField(max_length=250, verbose_name='Адрес', blank=True, default='', null=False)
    phone = models.CharField(max_length=30, verbose_name='Номер телефона', blank=True, default='', null=False)
    email = models.CharField(max_length=100, verbose_name='E-mail', blank=True, default='', null=False)
    map_latitude = models.FloatField(default=55.558741, verbose_name='Широта')
    map_longitude = models.FloatField(default=37.378847, verbose_name='Долгота')

    class Meta:
        verbose_name = "Страница Контакты"
        verbose_name_plural = "Страницы Контакты"
        ordering = ('-created_at',)

```

Затем добавляем в директорию `models` файл `__init__.py` со следующим содержимым:

```python
from .contact_page import ContactPage

```

Добавляем новое приложение `content` в `app/settings.py`:

```bash
# app/settings.py

INSTALLED_APPS += ['content']

```

После чего создаем миграции:

```bash
python3 manage.py makemigrations
```